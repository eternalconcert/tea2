job: build
image: cloud.canister.io:5000/eternalconcert/builder-default
stages:
  - name: dependencies
    run: |
      export DEBIAN_FRONTEND=noninteractive
      apt-get update
      apt-get install -y --no-install-recommends g++ flex bison
      lex src/patterns.l
      yacc -d src/grammar.y
      g++ lex.yy.c y.tab.c $(find src/ -name "*.cpp") -o tea --static -D BUILDNO=$BUILDER_RUN
      cp tea /out/tea_$BUILDER_RUN
  - name: tests
    run:
      /out/tea_$BUILDER_RUN tests/tests_basics.t
      /out/tea_$BUILDER_RUN tests/tests_operations.t
      /out/tea_$BUILDER_RUN tests/tests_comparisons.t
      /out/tea_$BUILDER_RUN tests/tests_conditions.t
      /out/tea_$BUILDER_RUN tests/tests_loops.t
